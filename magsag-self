#!/bin/bash
# MAGSAG Self-Hosting Launcher
# Use this to run MAGSAG on itself for parallel development

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export MAGSAG_REPO_DIR="$SCRIPT_DIR"
export ENGINE_MAG="${ENGINE_MAG:-codex-cli}"
export ENGINE_SAG="${ENGINE_SAG:-claude-cli}"

# Ensure built
if [ ! -d "$SCRIPT_DIR/packages/cli/dist" ]; then
    echo "Building CLI..."
    (cd "$SCRIPT_DIR" && pnpm build)
fi

# Check if the CLI exists
if [ ! -f "$SCRIPT_DIR/packages/cli/dist/index.js" ]; then
    echo "Error: CLI not found at packages/cli/dist/index.js"
    echo "Please run: pnpm build"
    exit 1
fi

# Execute MAGSAG CLI
exec node "$SCRIPT_DIR/packages/cli/dist/index.js" "$@"